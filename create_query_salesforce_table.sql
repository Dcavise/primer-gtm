CREATE OR REPLACE FUNCTION public.query_salesforce_table(table_name text, limit_count integer) RETURNS SETOF json LANGUAGE plpgsql SECURITY DEFINER AS $function$ BEGIN IF table_name IS NULL OR table_name = '' THEN RAISE EXCEPTION 'Table name cannot be null or empty'; END IF; IF limit_count IS NULL OR limit_count <= 0 THEN RAISE EXCEPTION 'Limit count must be a positive integer'; END IF; RETURN QUERY EXECUTE format('SELECT row_to_json(t) FROM (SELECT * FROM salesforce.%I LIMIT %L) t', table_name, limit_count); END; $function$; COMMENT ON FUNCTION public.query_salesforce_table IS 'Safely query a table in the Salesforce schema with a limit'; REVOKE ALL ON FUNCTION public.query_salesforce_table FROM PUBLIC; GRANT EXECUTE ON FUNCTION public.query_salesforce_table TO authenticated; GRANT EXECUTE ON FUNCTION public.query_salesforce_table TO service_role;
