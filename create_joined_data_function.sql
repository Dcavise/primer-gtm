CREATE OR REPLACE FUNCTION public.get_leads_with_campus_info(limit_count integer DEFAULT 100) RETURNS SETOF json LANGUAGE plpgsql SECURITY DEFINER AS $function$ BEGIN RETURN QUERY EXECUTE format('SELECT row_to_json(combined) FROM (SELECT l.*, c.name as campus_name, c.address as campus_address, c.city as campus_city, c.state as campus_state FROM salesforce.lead l LEFT JOIN public.campuses c ON l.campus = c.id LIMIT %L) combined', limit_count); END; $function$; COMMENT ON FUNCTION public.get_leads_with_campus_info IS 'Get leads with related campus information'; REVOKE ALL ON FUNCTION public.get_leads_with_campus_info FROM PUBLIC; GRANT EXECUTE ON FUNCTION public.get_leads_with_campus_info TO authenticated; GRANT EXECUTE ON FUNCTION public.get_leads_with_campus_info TO service_role;
